1.chronyd 
2.cgroupê°œë…

#ì„¤ì¹˜ ìœ íˆ¬ë¸Œ
https://www.youtube.com/watch?v=Wr6nrBRqYYE&list=PLbkeo0MyuahMfS9igIsWpLVXV-G_bg8dC&index=10&t=22s

apt update -y
apt install -y chrony
swapoff -a && sed -i '/swap/s/^/#/' /etc/fstab
reboot

# Kubernetes ì„¤ì¹˜

1. root ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
- sudo passwd root

> ssh ì„œë²„ ì„¤ì¹˜ í›„ ìš´ì˜
> 
- apt-get update && apt-get install -y openssh-server curl vim tree
- apt-get update && apt-get install -y socat conntrack ebtables ipset
- systemctl status sshd              << ìœ„ í”„ë¡œê·¸ë¨ì´ ì˜ ì„¤ì¹˜ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ëª…ë ¹ì–´
- ë¨¼ì € rootë¡œ vi /etc/hostname ë³€ê²½
- vi /etc/hosts ì¶”ê°€
- 

> ssh key generate
> 

#ssh-keygen
ssh-keygen -t rsa
touch ~/.ssh/authorized_keys
chmod 755 ~/.ssh/authorized_keys

> swap disabled
> 
- `swapoff -a && sed -i '/swap/s/^/#/' /etc/fstab`
- reboot

# Container Runner ì„¤ì¹˜(master, woker ë‘˜ë‹¤)

#í•„ìˆ˜ ìš”ì†Œë“¤ ì„¤ì¹˜ ë° êµ¬ì„±í•˜ê¸°
https://kubernetes.io/ko/docs/setup/production-environment/container-runtimes/

#container run time ì„¤ì¹˜
apt install -y containerd

#cgroup ì„¤ì • ë³€ê²½

- í´ë”ìƒì„±
mkdir -p /etc/containerd
- ê¸°ë³¸í™˜ê²½íŒŒì¼ ìƒì„±
containerd config default | sudo tee /etc/containerd/config.toml
- í™˜ê²½íŒŒì¼ ìˆ˜ì •

vi /etc/containerd/config.toml
.............
SystemdCgroup = false -> SystemdCgroup = true ë¡œ ë³€ê²½
..............

- ë³€ê²½ í›„ ì¬ì‹œì‘
systemctl restart containerd.service
systemctl status containerd.service

# kubernetes ì„¤ì¹˜(master, woker ë‘˜ë‹¤)

#kubeadm, kubectl, kubelet ì„¤ì¹˜

(ì°¸ê³ ) https://v1-28.docs.kubernetes.io/ko/docs/setup/production-environment/tools/kubeadm/install-kubeadm/

```
apt-get update

apt-get install -y apt-transport-https ca-certificates curl gpg

(kubernetes documentationì—ì„œ ì˜ë¬¸ë²„ì „ìœ¼ë¡œ í™•ì¸í• ê²ƒ)
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list

apt-get update

ë²„ì „í™•ì¸
root@rb-master:~# apt-cache madison kubeadm
   kubeadm | 1.28.6-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
   kubeadm | 1.28.5-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
   kubeadm | 1.28.4-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
   kubeadm | 1.28.3-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
   kubeadm | 1.28.2-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
   kubeadm | 1.28.1-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
   kubeadm | 1.28.0-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
 root@rb-master:/etc/containerd# apt-get install -y kubelet=1.28.6-1.1 kubeadm=1.28.6-1.1 kubectl=1.28.6-1.1

apt-mark hold kubelet kubeadm kubectl

```

# **Master ì»´í¬ë„ŒíŠ¸ êµ¬ì„±ë° ë„¤íŠ¸ì›Œí¬ í™˜ê²½êµ¬ì„±(master)**

<aside>
ğŸ’¡ kubeadm init --apiserver-advertise-address 172.30.1.95 --pod-network-cidr=10.1.0.0/16

</aside>

mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config

<aside>
ğŸ’¡ WORKER nodeì—ì„œ ì‹¤í–‰

kubeadm join 172.30.1.95:6443 --token nhojn9.fvb6735exa9bb2g8 \
--discovery-token-ca-cert-hash sha256:041afad12c845c5e073bbd4946c4a923bdddb5c658363094826453e128b21685

</aside>

root@rb-master:~# mkdir -p $HOME/.kube
root@rb-master:~# cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
root@rb-master:~# chown $(id -u):$(id -g) $HOME/.kube/config
root@rb-master:~# kubectl get nodes
NAME        STATUS     ROLES           AGE     VERSION
rb-master   NotReady   control-plane   8m47s   v1.28.6
root@rb-master:~# kubectl get nodes
NAME        STATUS     ROLES           AGE     VERSION
rb-master   NotReady   control-plane   9m29s   v1.28.6
rb-worker   NotReady   <none>          6s      v1.28.6

# Calico ì„¤ì¹˜ (master)

(ì°¸ê³ ì‚¬ì´íŠ¸)

https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart

mkdir cni
kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/custom-resources.yaml
í•˜ê¸°ì „ì— íŒŒì¼ ë‚´ìš©ì„ ê²€ì¦í•˜ê¸° ìœ„í•´
wget https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/custom-resources.yaml
ë‚´ìš© ìˆ˜ì •
........
cidr: 192.168.0.0/16 ---> cidr:10.1.0.0/16
.........

kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/tigera-operator.yaml
í•˜ê¸°ì „ì— íŒŒì¼ ë‚´ìš©ì„ ê²€ì¦í•˜ê¸° ìœ„í•´
wget https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/tigera-operator.yaml

ì, ì´ì œ ì„¤ì¹˜ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

kubectl create -f tigera-operator.yaml
kubectl create -f custom-resources.yaml

kubectl get all -n calico-system



